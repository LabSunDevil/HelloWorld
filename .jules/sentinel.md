## 2024-05-23 - [Second-Order SQL Injection in Recommendations]
**Vulnerability:** The `/api/recommendations` endpoint was vulnerable to Second-Order SQL Injection. Malicious strings stored in the `views` table (specifically `videoId`) were concatenated directly into a SQL query via the `watchedVideoIds` array in a `NOT IN (...)` clause. SQLite's dynamic typing allowed strings to be stored in the integer `videoId` column.
**Learning:** Always treat data retrieved from the database as untrusted, especially when constructing new queries. Dynamic SQL generation (like `IN (...)`) must use placeholders for every element in the list. SQLite's flexible typing can turn "integer" columns into injection vectors if input validation is missing at the insertion point.
**Prevention:** Use parameterized queries for all SQL statements, including dynamic lists. For `IN` clauses, generate a string of placeholders (`?, ?, ?`) matching the input array length and pass the array elements as parameters. Strictly validate input types before insertion (e.g. ensure `id` is actually an integer).
