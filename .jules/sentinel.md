## 2026-01-17 - Second-Order SQL Injection via SQLite Dynamic Typing
**Vulnerability:** Found a Second-Order SQL Injection in the `/api/recommendations` endpoint. The `watchedVideoIds` array, derived from the `views` table, was concatenated directly into a `NOT IN (...)` SQL clause. Because SQLite uses dynamic typing, the `videoId` column (defined as `INTEGER`) accepted arbitrary string payloads injected via the `/api/videos/:id/view` endpoint. These payloads were then executed when the recommendation query ran.
**Learning:** Data retrieved from the database should not be implicitly trusted, especially in databases like SQLite where type enforcement is loose. Even "internal" IDs can be vector for injection if the insertion path isn't strictly validated or if the column type isn't enforced.
**Prevention:** Always use parameterized queries (`?`), even for `IN/NOT IN` clauses involving arrays (generate placeholders dynamically). Treat all data sources, including the database itself, as potentially tainted.
