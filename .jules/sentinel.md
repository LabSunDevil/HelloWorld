## 2025-05-23 - Second Order SQL Injection via SQLite Type Affinity
**Vulnerability:** A second-order SQL injection vulnerability was found in the recommendations endpoint where `views` data was used in a `NOT IN` clause. The root cause was that SQLite's type affinity allowed non-integer strings (e.g., `'1) OR 1=1 --'`) to be stored in an `INTEGER` column (`videoId`). When retrieved and interpolated into a SQL query, this payload modified the query structure.
**Learning:** SQLite is dynamically typed, meaning declared column types are hints, not strict constraints. Input validation must be performed *before* insertion, even if the database schema defines the column as INTEGER. Furthermore, data retrieved from the database should never be trusted blindly in subsequent queries; parameterized queries are essential even for "internal" data.
**Prevention:** Always use parameterized queries for all SQL operations, including `IN` and `NOT IN` clauses with arrays. Validate input types strictly in the application layer before database insertion.
