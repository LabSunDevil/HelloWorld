## 2025-02-23 - SQLite Second-Order SQL Injection
**Vulnerability:** A second-order SQL injection was found in the `/api/recommendations` endpoint. The application allowed inserting strings into the `views.videoId` column (defined as INTEGER) due to SQLite's dynamic typing. These strings were later retrieved and concatenated directly into a `NOT IN (...)` SQL clause in the recommendations query.
**Learning:** SQLite's flexible typing system means column types are more like hints (affinities) than strict constraints. An attacker can store arbitrary text in an INTEGER column, which can then be used as a payload for SQL injection if the application trusts the database content to be of the declared type.
**Prevention:** Always use parameterized queries, even for data retrieved from the database. For `IN` or `NOT IN` clauses with variable-length arrays, dynamically generate the appropriate number of placeholders (e.g., `?, ?, ?`) and pass the values as parameters. Never concatenate values directly into SQL strings.
