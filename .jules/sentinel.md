## 2024-02-18 - [Second-Order SQL Injection via SQLite Dynamic Typing]
**Vulnerability:** A second-order SQL injection vulnerability was found in the `/api/recommendations` endpoint. The application trusted data retrieved from the `views` table (specifically `videoId`) to be integers, but since SQLite uses dynamic typing, non-integer strings could be stored in the `videoId` column via the unauthenticated `/api/videos/:id/view` endpoint. This data was then blindly concatenated into a `NOT IN` clause in a subsequent query.
**Learning:** Even if a database schema defines a column as `INTEGER`, the underlying database engine (like SQLite) might not enforce strict typing, allowing malicious strings to be stored and later retrieved. This violates the assumption that data from the database is "safe" or of a specific type.
**Prevention:** Always use parameterized queries (placeholders) for ALL variables, even those coming from the database. Never concatenate strings into SQL queries. Additionally, application-level validation should enforce types before insertion.
